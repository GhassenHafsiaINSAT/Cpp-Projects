# Makefiles

- You need a file called makefile to tell maje what to do.
- makefile tells make how to compile and link a program.  

## Makefile rules

```sh
target ... : prerequisites ...  
 recipe
 ... 
 ...

```

- A `target` is the file's name generated by the program (executables or object files) or name of action to carry out (`clean`).   

- A `prerequisite`, also called dependency, is used as input to create the target.

- A `recipe` is an action that make carries out

- Usually, a recipe is in a rule with prerequisites and serves to create a target file if any of the prerequisites change, a rule then describes how and one to remake certain files

## How `make` processes a Makefile

- `make` reads the makefile in the current directory and begin by processing the first rule.  
- By default, `make` starts with the first target (the default goal).
- Before `make` could fully process the target rule, it must process the rules for the files that the target depends on.
- The recompilation of the source files of targets must be done if the source or header file is more recent than the object file, or the object file does not exist.      

## Variables Make Makefilers simpler

- Here we had to list all the object files twice in the rule for edit:
  
```sh
edit : main.o kbd.o command.o display.o \
              insert.o search.o files.o utils.o
        cc -o edit main.o kbd.o command.o display.o \
                   insert.o search.o files.o utils.o
```
- We define such a variable objects:
```sh
objects = main.o kbd.o command.o display.o \
          insert.o search.o files.o utils.o

edit : $(objects)
        cc -o edit $(objects)
```

##  Letting make Deduce the Recipes

- Make has an implicit rule to update a `.o` from `.c` using `cc -c`
```sh
main.o : defs.h
```

## Make clean

- Makefiles can also delete all the object files and executables to make directory `clean`
- `clean` is often used as a target that removes the output of other targets

```sh
clean:
 rm -f some_file
```

## Variables

- Variables can only be strings, you can use `:=` or `=`.  
- single or double quotes have no meaning to Make.  
- Reference variables using either ${} or $()

```sh
files := file1 file2
some_file: $(files)
```
